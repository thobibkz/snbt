<!DOCTYPE html>
<html>
<head>
<title>Pengaturan - Rasionalisasi SNBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
  --blue:#1f6feb; --blue2:#4fa3ff; --bg:#f4f8ff; --card:#ffffff;
  --text:#1f2d3d; --muted:#6b7a90; --shadow:0 8px 25px rgba(0,0,0,.08);
  --red: #ef4444; --red2: #dc2626; /* Warna merah untuk logout */
}
/* Menyamakan layout dengan body index.html */
body { 
  margin:0; background:var(--bg); font-family:Segoe UI,Arial; 
  display:flex; justify-content:center; align-items:center; min-height:100vh;
}

.setting-card {
  background: var(--card); 
  width: 92%; 
  max-width: 360px; /* Ukuran lebar maksimal sama dengan login */
  padding: 22px;    /* Padding disamakan dengan login-card */
  border-radius: 22px; 
  box-shadow: var(--shadow);
  text-align: center;
  box-sizing: border-box; /* Memastikan padding tidak memperlebar box */
}
h2 { 
  margin:0 0 18px 0; 
  font-size:22px; 
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  -webkit-background-clip:text; color:transparent;
}
.form-group { 
  text-align: left; 
  margin-bottom: 12px; 
  width: 100%;
}
input:disabled { background:#f1f5f9; color:#94a3b8; cursor:not-allowed; }

input {
  width: 100%; 
  padding: 12px; 
  border-radius: 12px; 
  border: 1px solid #dbe7ff;
  font-size: 14px; 
  outline: none; 
  box-sizing: border-box; /* Sangat penting agar input tidak lebih lebar dari box */
}
  
.btn-group { display:flex; gap:10px; margin-top:20px; }
button {
  flex:1; padding:12px; border-radius:14px; border:none; cursor:pointer;
  font-weight:600; font-size:15px; transition:all 0.2s;
}
.btn-back { background:#f1f5f9; color:#475569; }
.btn-save { 
  background:linear-gradient(135deg,var(--blue),var(--blue2)); 
  color:white; box-shadow:0 4px 12px rgba(31,111,235,.3);
}

/* Style Tombol Logout Merah */
.btn-logout {
  width: 100%;
  margin-top: 15px;
  background: linear-gradient(135deg, var(--red), var(--red2));
  color: white;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}
.btn-logout:active { transform: scale(0.98); }

#msg { margin-top:12px; font-size:12px; color:#059669; display:none; font-weight:600; }
</style>
</head>
<body>

<div class="setting-card">
  <h2>Ubah Kata Sandi</h2>
  
  <div class="form-group">
    <label>Email (Login Sekarang)</label>
    <input type="text" id="displayEmail" disabled>
  </div>

  <div class="form-group">
    <label>Ubah Kata Sandi</label>
    <input type="password" id="newPass" placeholder="Masukkan kata sandi baru">
  </div>

  <div class="btn-group">
    <button class="btn-back" onclick="goBack()">Kembali</button>
    <button class="btn-save" onclick="savePassword()">Simpan</button>
  </div>

  <button class="btn-logout" onclick="logout()">LOGOUT</button>

  <div id="msg">✅ Kata sandi berhasil disimpan</div>
</div>

<script>
const userEmail = localStorage.getItem("email"); 
const userRole = localStorage.getItem("role");

if(!userEmail) {
  alert("Sesi berakhir, silakan login kembali");
  location.href = "index.html";
} else {
  document.getElementById("displayEmail").value = userEmail;
}

function goBack() {
  if(userRole === "admin") {
    location.href = "admin.html";
  } else {
    location.href = "publik.html";
  }
}

// FUNGSI LOGOUT
function logout() {
  if(confirm("Apakah Anda yakin ingin keluar?")) {
    localStorage.clear(); // Hapus semua sesi
    location.href = "index.html";
  }
}

function savePassword() {
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbye4Gi6Jy4BBlNt3P3hVQ6rDi0B__7sF_nH9R8zzbOTQ_SVPO3gxba8dJjnIQPoRRV7Ng/exec";

  const newPass = document.getElementById("newPass").value;
  if(!newPass) { alert("Masukkan kata sandi baru!"); return; }

  const btn = document.querySelector(".btn-save");
  btn.innerText = "⏳ Menyimpan...";
  btn.disabled = true;

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "updatePassword",
      email: userEmail,
      newPass: newPass
    })
  })
  .then(response => response.json())
  .then(result => {
    if(result.status === "success") {
       document.getElementById("msg").style.display = "block";
       document.getElementById("newPass").value = "";
       setTimeout(() => { document.getElementById("msg").style.display = "none"; }, 3000);
    } else {
       alert("Gagal: " + result.status);
    }
    btn.innerText = "Simpan";
    btn.disabled = false;
  })
  .catch(err => {
    console.error(err);
    alert("Terjadi kesalahan koneksi!");
    btn.disabled = false;
    btn.innerText = "Simpan";
  });
}
</script>
</body>
</html>
