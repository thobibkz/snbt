<!DOCTYPE html>
<html>
<head>
<title>Pengaturan - Rasionalisasi SNBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
  --blue:#1f6feb; --blue2:#4fa3ff; --bg:#f4f8ff; --card:#ffffff;
  --text:#1f2d3d; --muted:#6b7a90; --shadow:0 8px 25px rgba(0,0,0,.08);
}
/* Menyamakan layout dengan body index.html */
body { 
  margin:0; background:var(--bg); font-family:Segoe UI,Arial; 
  display:flex; justify-content:center; align-items:center; height:100vh;
}
/* UKURAN DISAMAKAN DENGAN .login-card index.html */
.setting-card {
  background:var(--card); 
  width:92%; 
  max-width:360px; /* Sama dengan index.html */
  padding:22px; 
  border-radius:22px; 
  box-shadow:var(--shadow);
  text-align:center;
}
h2 { 
  margin:0 0 18px 0; 
  font-size:22px; 
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  -webkit-background-clip:text; color:transparent;
}
.form-group { text-align:left; margin-bottom:12px; }
label { display:block; font-size:13px; font-weight:600; margin-bottom:5px; color:var(--muted); }
input {
  width:100%; padding:12px; border-radius:12px; border:1px solid #dbe7ff;
  font-size:14px; outline:none; box-sizing:border-box;
}
input:disabled { background:#f1f5f9; color:#94a3b8; cursor:not-allowed; }

.btn-group { display:flex; gap:10px; margin-top:20px; }
button {
  flex:1; padding:12px; border-radius:14px; border:none; cursor:pointer;
  font-weight:600; font-size:15px; transition:all 0.2s;
}
.btn-back { background:#f1f5f9; color:#475569; }
.btn-save { 
  background:linear-gradient(135deg,var(--blue),var(--blue2)); 
  color:white; box-shadow:0 4px 12px rgba(31,111,235,.3);
}
#msg { margin-top:12px; font-size:12px; color:#059669; display:none; font-weight:600; }
</style>
</head>
<body>

<div class="setting-card">
  <h2>Rubah Kata Sandi</h2>
  
  <div class="form-group">
    <label>Email (Login Sekarang)</label>
    <input type="text" id="displayEmail" disabled>
  </div>

  <div class="form-group">
    <label>Ubah Kata Sandi</label>
    <input type="password" id="newPass" placeholder="Masukkan kata sandi baru">
  </div>

  <div class="btn-group">
    <button class="btn-back" onclick="goBack()">Kembali</button>
    <button class="btn-save" onclick="savePassword()">Simpan</button>
  </div>

  <div id="msg">✅ Kata sandi berhasil disimpan</div>
</div>

<script>
// AMBIL DATA DARI LOCAL STORAGE
const userEmail = localStorage.getItem("email"); 
const userRole = localStorage.getItem("role");

// Validasi jika belum login
if(!userEmail) {
  alert("Sesi berakhir, silakan login kembali");
  location.href = "index.html";
} else {
  document.getElementById("displayEmail").value = userEmail;
}

function goBack() {
  if(userRole === "admin") {
    location.href = "admin.html";
  } else {
    location.href = "publik.html";
  }
}

function savePassword() {
  const newPass = document.getElementById("newPass").value;
  if(!newPass) { alert("Masukkan kata sandi baru!"); return; }

  const btn = document.querySelector(".btn-save");
  btn.innerText = "⏳...";
  btn.disabled = true;

  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzyPZYlzSJ9ZPCMGuJ70-Lf96IJiZWVlDV02sCFj2oRVUhCJMICWljVnT4TA70xT0fWxA/exec";

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "updatePassword",
      email: userEmail,
      newPass: newPass
    })
  })
  .then(() => {
    document.getElementById("msg").style.display = "block";
    btn.innerText = "Simpan";
    btn.disabled = false;
    document.getElementById("newPass").value = "";
    setTimeout(() => { document.getElementById("msg").style.display = "none"; }, 3000);
  })
  .catch(err => {
    alert("Koneksi gagal!");
    btn.disabled = false;
    btn.innerText = "Simpan";
  });
}
</script>
</body>
</html>
