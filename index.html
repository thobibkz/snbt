<!DOCTYPE html>
<html>
<head>
<title>Login Rasionalisasi SNBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --blue:#1f6feb;
  --blue2:#4fa3ff;
  --bg:#f4f8ff;
  --card:#ffffff;
  --text:#1f2d3d;
  --muted:#6b7a90;
  --shadow:0 8px 25px rgba(0,0,0,.08);
}

*{box-sizing:border-box;font-family:Segoe UI,Arial,sans-serif;}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

/* LOGIN CARD */
.login-card{
  background:var(--card);
  width:92%;
  max-width:360px;
  padding:22px;
  border-radius:22px;
  box-shadow:var(--shadow);
}

/* HEADER */
.login-header{
  text-align:center;
  margin-bottom:18px;
}

.login-header h2{
  margin:0;
  font-size:22px;
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  -webkit-background-clip:text;
  color:transparent;
}

.login-header p{
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
}

/* INPUT */
input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #dbe7ff;
  margin-bottom:12px;
  font-size:14px;
}

/* BUTTON */
button{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  color:white;
  font-weight:600;
  font-size:15px;
  box-shadow:0 4px 12px rgba(31,111,235,.3);
  cursor:pointer;
}

button:active{
  transform:scale(.98);
}

/* FOOTER */
.footer{
  text-align:center;
  margin-top:12px;
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>

<div class="login-card">

  <div class="login-header">
    <h2>Rasionalisasi SNBT</h2>
    <p>Login untuk analisis peluang masuk PTN</p>
  </div>

  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Password">

  <button onclick="login()">LOGIN</button>

  <div class="footer">
    Sistem Analisis SNBT Â© 2026
  </div>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx7ppUM70BdCrOVORQeL7JEtcQl1amvwvxJwPrzZgz3AKWQygxc79f8ItHzJBF8UMcOjA/exec"; // Apps Script API login

function login() {
  let email = document.getElementById("email").value;
  let pass = document.getElementById("pass").value;

  // 1. Validasi input kosong
  if (!email || !pass) {
    alert("Silakan isi email dan password!");
    return;
  }

  // Menampilkan indikator loading (opsional tapi disarankan)
  console.log("Mencoba login...");

  fetch(`${API}?action=auth_req&email=${encodeURIComponent(email)}&pass=${encodeURIComponent(pass)}`)
    .then(r => r.json())
    .then(d => {
      if (d.status == "ok") {
        // --- PERBAIKAN DI SINI ---
        // Simpan email untuk keperluan fitur 'Setting' dan 'Ping'
        localStorage.setItem("email", email); 
        // Simpan role untuk navigasi halaman
        localStorage.setItem("role", d.role);
        // Simpan lastOpen sebagai 'ID Sesi' unik untuk deteksi 2 device
        localStorage.setItem("lastOpen", d.lastOpen); 

        localStorage.setItem("masaAktif", d.masaAktif);
        
        // Pengalihan halaman berdasarkan role
        if (d.role == "admin") {
          location.href = "admin.html";
        } else {
          location.href = "publik.html";
        }
      } 
      // --- TAMBAHAN LOGIKA MASA AKTIF ---
      else if (d.status == "expired") {
        alert("Masa aktif akun anda sudah habis, silahkan hubungi admin");
      } 
      else {
        alert("Email atau password salah");
      }
    })
    .catch((err) => {
      console.error("Login Error:", err);
      alert("Gagal terhubung ke server. Periksa koneksi internet atau Deployment Apps Script Anda.");
    });
}
</script>

</body>
</html>
